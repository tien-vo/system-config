---
- name: Fetch user info
  ansible.builtin.user:
    name: "{{ user.name }}"
    state: present
  register: user_info
  check_mode: true
  changed_when: false

- name: Create neovim config directory
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.file:
    path: "{{ user_info.home }}/.config/nvim"
    state: directory
    owner: "{{ user.name }}"
    group: "{{ user.name }}"

- name: Symlink neovim config for user `{{ user.name }}`
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.file:
    src: "{{ role_path }}/files"
    dest: "{{ user_info.home }}/.config/nvim"
    follow: true
    state: link
    force: true
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
